# ATP manual

## Name

atp - Assembly Testing Program

## Description

**ATP** is a testing tool made for checking assembly code efficency. This tool offers two main actions: **generation** and **validation**.
The generation phase will generate assembly code for every compilers and architectures. Then this code is stored in a reference folder.
The validation phase will compare the assembly code generate by the current library version with the assembly code previouly saved (in the reference folder). 


## Options

**-c** *compiler*, **--compiler** *compiler*
$\,\,\,\,\,\,\,\,\,$ The code is only generated and tested for the given compiler.

**-d** $\,\,\,\,$ Deep generation. When generating assembly this option will replace existing files even though they already contain assembly code. Enable this option when you want to update reference files outdated (otherwise reference files are not changed if they already exist).

**-D** *tool*, **-disassembler** *tool*
$\,\,\,\,\,\,\,\,\,$ Defines the disassembling tool. Available disassembling tools are `standard` (*-S* option of compilers) or `objdump`. Assembly code generated by one of this tool can't be validated by the other. Default value is `objdump`. The *standard* option is only available with *gcc* and *clang* compilers.

**-f** , **--fatal**
$\,\,\,\,\,\,\,\,\,$ Raises exception. This option interrupts the testing process if there is an assembly mismatch error. Useless for generation.

**--flags** *flags*
$\,\,\,\,\,\,\,\,\,$ Flags used for compilation. Flags musn't contain dashes. It has the highest priority for the compilation process. It means that if flags are given, *-m* options is ignored even though it's also given. If there are no flags, default flags are used.

**-g** $\,\,\,\,$ Generation mode. Generates assembly code and stores it in `ref`. Without this option, the default mode is validation.

**-i** $\,\,\,\,$ Instruction comparison. Compares only instructions and ignores their parameters.

**-input** *files* | *group*
$\,\,\,\,\,\,\,\,\,$ Defines your own input file or group. Without this option all config files are used. The given file must exist in folder `config`. If a group is given it mist exist in `settings.json`. The priority is *config file*, *group*, *all*. When generating, it only generates those files. When validating, it only compares those files.

**-l** $\,\,\,\,$ Log. Generates a log file giving details about errors that occured during the validation. Two types of errors are described: *comparison errors* that occured when assembly code doesn't correspond and *missing reference* that occured when a function doesn't have a reference file.

**--output** *path*
$\,\,\,\,\,\,\,\,\,$ The path of the output. If this option is not defined, it takes the default path which is the directory *ref*.

**--ref** *reference_path*
$\,\,\,\,\,\,\,\,\,$ Defines a custom path for the reference folder. When generating it changes the location of the stored files. When validating it changes the place we get the reference files.

**--reset**
$\,\,\,\,\,\,\,\,\,$ Clears the `ref` directory.

**-s** *setup*, **--setup** *setup*
$\,\,\,\,\,\,\,\,\,$ The code is only generated and validated for the given simd extension. The given extension name **must** exist in `settings.json`.

**-S** *limit*, **--functionsperfile** *limit*
$\,\,\,\,\,\,\,\,\,$ Limit the number of functions in *cpp* files. If the number of functions is greater than the limit it creates several *cpp* files that are compiled seperately.


**-t** $\,\,\,\,$ Keeps temporary files after the process. Temporary files are files used to produce assembly code:
- tmp.cpp : Contains generated cpp functions
- tmp.o : Compiled file
- tmp.txt : Contains assembly code extracts from tmp.o.

**-v** $\,\,\,\,$ Verbose. Displays information in the command line. At the end of the process it gives the time elapsed since the beginning of the process.


## Examples

### Generation
Generate reference files for all config files in the *config* directory:

    > python3 atp.py -g -v
    Generating assembly : 100% done
    Operation finished : functions saved
    Process duration: 39.84s

Generate reference files for a group and a given compiler:

    > python3 atp.py -g -v -c gcc --input abs
    Generating assembly : 100% done
    Operation finished : functions saved
    Process duration: 12.56s

Generate reference file for given config file and setup **stored in `settings.json`**:

    > python3 atp.py -g -v -s sse --input abs.json
    Generating assembly : 100% done
    Operation finished : functions saved
    Process duration: 2.45s
